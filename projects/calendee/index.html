<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Base -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Pelican" />
    <meta name="author" content="Nic Deville">

<!-- Title -->
<title>Calendee | Nic's notes</title>
<meta name="og:title" content="Calendee | Nic's notes"/> <!-- 40 characters for mobile and 60 for desktop -->
<link rel="canonical" href="https://notes.nicolasdeville.com/projects/calendee" />
<meta name="twitter:title" content="Calendee | Nic's notes" /> <!-- max. 70 characters -->

<meta name="description" content="my own Python-powered Calendly alternative"/>
<meta property="og:description" content="my own Python-powered Calendly alternative"/>
<meta name="twitter:description" content="my own Python-powered Calendly alternative" /> <!-- max. 200 characters -->
 

<meta property="article:published_time" content="2023-05-06 10:44:00.826110+02:00" />

<meta property="article:modified_time" content="2023-05-06 10:44:00.826110+02:00" />

<meta name="robots" content="all, follow" />

<!-- Social -->
<meta property="og:type" content="article" />

<!-- <meta property="og:description" content="Messy online notebook covering B2B Sales, Leadership, Python programming, Automation, AI and more. I take these notes for myself (and my kids later) - perhaps they can help someone else..." /> min. 2 max. 4 sentences -->

<meta property="og:url" content="https://notes.nicolasdeville.com/projects/calendee" /> <!-- canonical URL for your page without session variables, user id parameters or counters -->
<meta property="og:site_name" content="Nic's notes" />
<meta name="image" property="og:image" content="https://ik.imagekit.io/vhucnsp9j1u/images/notes-twitter-image.jpg" /> <!-- at least 600x315 pixels, preferable 1200x630 pixels -->

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@ndeville" />

<meta name="twitter:image" content="https://ik.imagekit.io/vhucnsp9j1u/images/notes-twitter-image.jpg" /> <!-- aspect ratio of 2:1 with minimum dimensions of 300x157 or maximum of 4096x4096 pixels. Going with 900x471 -->

<!-- Logo -->
<meta property="og:logo" content="https://notes.nicolasdeville.com/logo.svg">

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="https://notes.nicolasdeville.com/favicon.ico">
<link rel="mask-icon" href="https://notes.nicolasdeville.com/favicon.svg" color="#FFFFFF">
<link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://notes.nicolasdeville.com/favicon.png">
<link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://notes.nicolasdeville.com/favicon.svg">
<link rel="fluid-icon" href="https://notes.nicolasdeville.com/favicon.png" title="Nic's notes">

<!-- CSS -->
<link rel="stylesheet" href="https://notes.nicolasdeville.com/theme/css/main.css" />

<!-- Pagefind -->
<link href="https://notes.nicolasdeville.com/theme/css/pagefind-ui-nic.css" rel="stylesheet">
<script src="https://notes.nicolasdeville.com/pagefind/pagefind-ui.js" type="text/javascript"></script>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search" });
    });
</script>


</head>

<body id="index" class="body">
        <header id="banner" class="body">

            <div class="logo-and-search">
                <a href="https://notes.nicolasdeville.com/"><img class="header_image" src="https://ik.imagekit.io/vhucnsp9j1u/images/nic_notes_header.svg" alt="Nic's notes" width="266"/></a>

                <!-- Pagefind -->
                <div class="search-input-block" id="search"></div>

            </div>

            

            <div class="above-navbar">
                <div class="last_updated">28 Jun 2024 | 06:00</div>
                <div>
                    <p class="notes_count">
                        <a href="https://notes.nicolasdeville.com/tags">by tags</a>
                        <span style="color:#C74350">|</span>
                        <a href="https://notes.nicolasdeville.com/2020/">2020</a>
                        <span style="color:#C74350">|</span>
                        <a href="https://notes.nicolasdeville.com/2021/">2021</a>
                        <span style="color:#C74350">|</span>
                        <a href="https://notes.nicolasdeville.com/2022/">2022</a>
                        <span style="color:#C74350">|</span>
                        697 notes
                    </p>
                </div>
            </div>

            <nav><ul>
                <li><a href="https://notes.nicolasdeville.com/ai/">ai</a></li>
                <li><a href="https://notes.nicolasdeville.com/apps/">apps</a></li>
                <li><a href="https://notes.nicolasdeville.com/b2b-sales/">b2b sales</a></li>
                <li><a href="https://notes.nicolasdeville.com/books/">books</a></li>
                <li><a href="https://notes.nicolasdeville.com/careerplaybook/">#careerplaybook</a></li>
                <li><a href="https://notes.nicolasdeville.com/helpers/">helpers</a></li>
                <li><a href="https://notes.nicolasdeville.com/home-office/">home office</a></li>
                <li><a href="https://notes.nicolasdeville.com/interests/">interests</a></li>
                <li><a href="https://notes.nicolasdeville.com/leadership/">leadership</a></li>
                <li><a href="https://notes.nicolasdeville.com/learning/">learning</a></li>
                <li><a href="https://notes.nicolasdeville.com/movies/">movies</a></li>
                <li class="active"><a href="https://notes.nicolasdeville.com/projects/">projects</a></li>
                <li><a href="https://notes.nicolasdeville.com/python/">python</a></li>
                <li><a href="https://notes.nicolasdeville.com/random/">random</a></li>
                <li><a href="https://notes.nicolasdeville.com/video/">video</a></li>
            </ul></nav>
        </header>

        <!-- index.html injection -->
<section id="content" class="body">
    <article>
        <header>
            <h1 class="entry-title">
                <main> <!-- for indexing by Stork -->
                    <a href="https://notes.nicolasdeville.com/projects/calendee" rel="bookmark"
                    title="Permalink to Calendee">Calendee
                    </a>
                </main>
            </h1>
            <p class="header_summary">
                <main> <!-- for indexing by Stork -->
                    <p>my own Python-powered Calendly alternative</p>
                </main>
            </p>
        </header>

        <div class="entry-content">
<footer class="post-info">

    <p>
        06 May 2023 
        <span class="separator">|</span> in <a class="link_tag" href="https://notes.nicolasdeville.com/projects/"><span data-pagefind-filter="category">projects</span></a>


        <!-- added 4/7 -->
        <!-- 		<br />
        <abbr class="modified" title="2023-05-06T10:44:00.826110+02:00">
                Updated: 06 May 2023
        </abbr>
 -->

    </p>

    

</footer>            <!-- for indexing by Stork -->
            <!-- <main>  -->
                <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#availabilities">Availabilities</a><ul>
<li><a href="#process">Process</a></li>
<li><a href="#working-code">working code</a><ul>
<li><a href="#variables">variables</a></li>
<li><a href="#outputs">outputs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#meetings">Meetings</a></li>
<li><a href="#issues">Issues</a><ul>
<li><a href="#token-resolved">Token (RESOLVED)</a></li>
</ul>
</li>
</ul>
</div>
<p>Open-sourced at:  </p>
<div class="link_border"><div class="link_logo_box"><img class="link_logo" src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/github.png" alt="logo"/></div><div class="link_content">
<div class="link_title">GitHub - ndeville/calendee: Generates availabilities as text to be inserted anywhere, checking with Google Calendar API</div>
<div class="link_tagline">github.com</div>
<div class="link_url"><a href="https://github.com/ndeville/calendee" target="_blank">https://github.com/ndeville/calendee</a></div></div></div>

<h1 id="availabilities">Availabilities</h1>
<p><span class="datestamp">13 Feb 2023</span>   </p>
<p>Goal:<br>
- insert my availabilities as text in an email.<br>
- ability to select timezone of the recipient (method TBC)<br>
- combines availabilities across my 2 pro calendars (both using Google Calendar)</p>
<p>Output should be like: </p>
<div class="highlight"><pre><span></span><code>Germany
- Wed 15 Feb 10:00
- Wed 15 Feb 11:00
- Fri 17 Feb 10:00
</code></pre></div>

<p>with date/time format adapted based on recipient's timezone: </p>
<div class="highlight"><pre><span></span><code>PT
- Wed Feb 15 10am
- Wed Feb 15 11am
- Fri 17 Feb 3pm
</code></pre></div>

<p>so:  </p>
<div class="highlight"><pre><span></span><code>{recipient_timezone}
- {date} {time}
- {date} {time}
- {date} {time}
</code></pre></div>

<p>Timezone selection passed as a parameter to the script.  </p>
<p>v2:<br>
- "tomorrow" when applicable (instead of full date)</p>
<h2 id="process">Process</h2>
<p>Authorisation works by creating a token file using the Credentials JSON file downloaded from Google.   </p>
<div class="link_border"><div class="link_logo_box"><img class="link_logo" src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/google.png" alt="logo"/></div><div class="link_content">
<div class="link_title">Create access credentials  |  Google Workspace  |  Google Developers</div>
<div class="link_tagline">google.com</div>
<div class="link_url"><a href="https://developers.google.com/workspace/guides/create-credentials" target="_blank">https://developers.google.com/workspace/guides/create-credentials</a></div></div></div>

<p>Steps:  </p>
<ul>
<li>Access <code>https://console.cloud.google.com/apis</code></li>
<li>Create a new project</li>
<li>Enable the Google Calendar API</li>
<li>Create a new OAuth client ID<br>
<img class="screenshot" src="https://ik.imagekit.io/vhucnsp9j1u/images/calendaree/google-cloud-calendaree-dv-oauth.jpg" alt="calendaree/google-cloud-calendaree-dv-oauth.jpg"/>  </li>
<li>Download the credentials JSON file</li>
<li>save it as <code>credentials.json</code> in the same folder as <code>quickstart.py</code> (next step)</li>
<li>
<p>Create a <code>quickstart.py</code> with below code, run, authenticate in browser, create the token file.</p>
</li>
<li>
<p>Create a <code>service_key.json</code> at <code>https://console.cloud.google.com/iam-admin/serviceaccounts/create</code><br>
In the menu, click on "APIs &amp; Services" &gt; "Credentials."<br>
Click on "Create credentials" and choose "Service account."<br>
Enter a name for the service account, and optionally, add a description. Click "Create."<br>
Optionally, you can grant the service account a role with specific permissions. Click "Continue."<br>
Click "Done" to create the service account.<br>
In the "Service Accounts" section, find the service account you just created and click on its name.<br>
In the "Keys" tab, click on "Add Key" and choose "JSON."<br>
The JSON key file will be generated and downloaded to your computer. This is your service_key.json file.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># quickstart.py</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">google.auth.transport.requests</span> <span class="kn">import</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">google.oauth2.credentials</span> <span class="kn">import</span> <span class="n">Credentials</span>
<span class="kn">from</span> <span class="nn">google_auth_oauthlib.flow</span> <span class="kn">import</span> <span class="n">InstalledAppFlow</span>
<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">googleapiclient.errors</span> <span class="kn">import</span> <span class="n">HttpError</span>

<span class="c1"># If modifying these scopes, delete the file token.json.</span>
<span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.googleapis.com/auth/calendar.readonly&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Shows basic usage of the Google Calendar API.</span>
<span class="sd">    Prints the start and name of the next 10 events on the user&#39;s calendar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># The file token.json stores the user&#39;s access and refresh tokens, and is</span>
    <span class="c1"># created automatically when the authorization flow completes for the first</span>
    <span class="c1"># time.</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">):</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="n">Credentials</span><span class="o">.</span><span class="n">from_authorized_user_file</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">,</span> <span class="n">SCOPES</span><span class="p">)</span>
    <span class="c1"># If there are no (valid) credentials available, let the user log in.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">creds</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">creds</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">creds</span> <span class="ow">and</span> <span class="n">creds</span><span class="o">.</span><span class="n">expired</span> <span class="ow">and</span> <span class="n">creds</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
            <span class="n">creds</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">Request</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="n">InstalledAppFlow</span><span class="o">.</span><span class="n">from_client_secrets_file</span><span class="p">(</span>
                <span class="s1">&#39;credentials.json&#39;</span><span class="p">,</span> <span class="n">SCOPES</span><span class="p">)</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">run_local_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Save the credentials for the next run</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">creds</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>

        <span class="c1"># Call the Calendar API</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>  <span class="c1"># &#39;Z&#39; indicates UTC time</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting the upcoming 10 events&#39;</span><span class="p">)</span>
        <span class="n">events_result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">events</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">calendarId</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="n">timeMin</span><span class="o">=</span><span class="n">now</span><span class="p">,</span>
                                              <span class="n">maxResults</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">singleEvents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;startTime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">events_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No upcoming events found.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Prints the start and name of the next 10 events</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dateTime&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">])</span>

    <span class="k">except</span> <span class="n">HttpError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;An error occurred: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">error</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>Initial basic code works as follows:  </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">google.oauth2.credentials</span> <span class="kn">import</span> <span class="n">Credentials</span>

<span class="k">def</span> <span class="nf">get_future_events</span><span class="p">(</span><span class="n">calendar_id</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="c1"># Set up Google API credentials</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="n">Credentials</span><span class="o">.</span><span class="n">from_authorized_user_file</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;https://www.googleapis.com/auth/calendar&#39;</span><span class="p">])</span>

    <span class="c1"># Build the Google Calendar API client</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>

    <span class="c1"># Get the current time in UTC</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>  <span class="c1"># &#39;Z&#39; indicates UTC time</span>

    <span class="c1"># Call the Google Calendar API to get events</span>
    <span class="n">events_result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">events</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
        <span class="n">calendarId</span><span class="o">=</span><span class="n">calendar_id</span><span class="p">,</span>
        <span class="n">timeMin</span><span class="o">=</span><span class="n">now</span><span class="p">,</span>
        <span class="n">singleEvents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;startTime&#39;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="c1"># Get the events from the response</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">events_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="c1"># Filter out events that have already ended</span>
    <span class="n">future_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dateTime&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)]</span>

    <span class="c1"># Return the list of future events</span>
    <span class="k">return</span> <span class="n">future_events</span>
</code></pre></div>

<p>Note: <code>token</code> is the path to the token file created by the <code>quickstart.py</code> script.    </p>
<p><span class="datestamp">16 Feb 2023</span> </p>
<p>Basic logic is working. <br>
Some troubleshooting left re removing available time when events span more than 1 hour + formatting of output, currently coming out as:  </p>
<div class="highlight"><pre><span></span><code>- tomorrow 12:00
- tomorrow 17:00
- Mon 20th 12:00
- Tue 21st 17:00
- Wed 22nd 12:00
- Thu 23rd 12:00
</code></pre></div>

<h2 id="working-code">working code</h2>
<p>See:  </p>
<div class="link_border"><div class="link_logo_box"><img class="link_logo" src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/github.png" alt="logo"/></div><div class="link_content">
<div class="link_title">calendee/availabilities.py at main · ndeville/calendee · GitHub</div>
<div class="link_tagline">github.com</div>
<div class="link_url"><a href="https://github.com/ndeville/calendee/blob/main/availabilities.py" target="_blank">https://github.com/ndeville/calendee/blob/main/availabilities.py</a></div></div></div>

<h3 id="variables">variables</h3>
<p>are <code>available_days</code>, <code>available_hours</code>, <code>timezones</code>, <code>slot</code> &amp; <code>weekdays_forward</code>:  </p>
<div class="highlight"><pre><span></span><code><span class="n">slot</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># minutes</span>

<span class="c1"># How many weekdays forward to check for availability</span>
<span class="n">weekdays_forward</span> <span class="o">=</span> <span class="mi">3</span> 

<span class="n">available_days</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># comment lines below to make unavailable</span>
    <span class="s2">&quot;Mon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Wed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Thu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fri&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">available_hours</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># comment lines below to make unavailable</span>
    <span class="c1"># &quot;08:00&quot;,</span>
    <span class="c1"># &quot;09:00&quot;,</span>
    <span class="c1"># &quot;10:00&quot;,</span>
    <span class="s2">&quot;11:00&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;11:30&quot;,</span>
    <span class="s2">&quot;12:00&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;13:00&quot;,</span>
    <span class="c1"># &quot;14:00&quot;,</span>
    <span class="c1"># &quot;15:00&quot;,</span>
    <span class="s2">&quot;16:00&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;16:30&quot;,</span>
    <span class="s2">&quot;17:00&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;18:00&quot;,</span>
    <span class="c1"># &quot;19:00&quot;,</span>
<span class="p">]</span>


<span class="n">timezones</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># This will define the return time &amp; format</span>
    <span class="s2">&quot;CET&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># default</span>
    <span class="s2">&quot;UK&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># timezone offset in hours</span>
    <span class="s2">&quot;ET&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;MT&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s2">&quot;PT&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="outputs">outputs</h3>
<p>Standard:  </p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>CET / Germany <span class="nb">time</span><span class="o">)</span>

- Mon  6th <span class="m">12</span>:00
- Tue  7th <span class="m">11</span>:00, <span class="m">12</span>:00 or <span class="m">17</span>:00
- Wed  8th <span class="m">11</span>:00, <span class="m">12</span>:00, <span class="m">16</span>:00 or <span class="m">17</span>:00

or see all at https://cal.com/ndeville
</code></pre></div>

<p>UK:  </p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>UK <span class="nb">time</span><span class="o">)</span>

- Mon  6th 11am
- Tue  7th 10am, 11am or 4pm
- Wed  8th 10am, 11am, 3pm or 4pm

or see all at https://cal.com/ndeville
</code></pre></div>

<p>PT: </p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>PT<span class="o">)</span>

- Mon  6th 3am
- Tue  7th 2am, 3am or 8am
- Wed  8th 2am, 3am, 7am or 8am

or see all at https://cal.com/ndeville
</code></pre></div>

<h1 id="meetings">Meetings</h1>
<p>Generates list of past meetings objects when external attendees present, for ingestion anywhere (eg. CRM).  </p>
<p>Each meeting returned as:  </p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Meeting</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># from Google</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># from Google &#39;start&#39;, in YYYY-MM-DD format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlLink</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attendees</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># unique emails from both &#39;attendees&#39; and &#39;organiser&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># WARNING: this caters only for 1 domain per meeting</span>
</code></pre></div>

<p>See:  </p>
<div class="link_border"><div class="link_logo_box"><img class="link_logo" src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/github.png" alt="logo"/></div><div class="link_content">
<div class="link_title">calendee/meetings.py at main · ndeville/calendee · GitHub</div>
<div class="link_tagline">github.com</div>
<div class="link_url"><a href="https://github.com/ndeville/calendee/blob/main/meetings.py" target="_blank">https://github.com/ndeville/calendee/blob/main/meetings.py</a></div></div></div>

<h1 id="issues">Issues</h1>
<h2 id="token-resolved">Token (RESOLVED)</h2>
<p>Token needs to be refreshed every day? <br>
Need to find how to configure for perpetual use, or automate.  </p>
<p>Seems like using a "Service Account" with "Domain Wide Delegation" is the way to go: <a href="https://medium.com/@ArchTaqi/google-calendar-api-in-your-application-without-oauth-consent-screen-4fcc1f8eb380" target="_blank">https://medium.com/@ArchTaqi/google-calendar-api-in-your-application-without-oauth-consent-screen-4fcc1f8eb380</a></p>
<div class="link_border"><div class="link_logo_box"><img class="link_logo" src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/google.png" alt="logo"/></div><div class="link_content">
<div class="link_title">Control API access with domain-wide delegation - Google Workspace Admin Help</div>
<div class="link_tagline">google.com</div>
<div class="link_url"><a href="https://support.google.com/a/answer/162106?product_name=UnuFlow&hl=en&visit_id=638120857399575487-3089946761&rd=1&src=supportwidget0&hl=en#zippy=%2Cbefore-you-begin%2Cset-up-domain-wide-delegation-for-a-client" target="_blank">https://support.google.com/a/answer/162106?product_name=UnuFlow&hl=en&visit_id=638120857399575487-3089946761&rd=1&src=supportwidget0&hl=en#zippy=%2Cbefore-you-begin%2Cset-up-domain-wide-delegation-for-a-client</a></div></div></div>

<p><img class="screenshot" src="https://ik.imagekit.io/vhucnsp9j1u/images/calendaree/230215-2026-google-admin-domain-wide-delegation.jpg" alt="calendaree/230215-2026-google-admin-domain-wide-delegation.jpg"/>  </p>
<p>Solved with:  </p>
<ul>
<li>create Service account &amp; download Service key as '.json' file (see Medium article above)</li>
<li>apply Domain Wide Delegation to the Service account (see Google Admin article above) </li>
<li>use following code:   </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">google.oauth2</span> <span class="kn">import</span> <span class="n">service_account</span>

<span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.googleapis.com/auth/calendar&#39;</span><span class="p">]</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="n">service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_file</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">)</span>
<span class="n">creds</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">with_subject</span><span class="p">(</span><span class="n">calendar_id</span><span class="p">)</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
</code></pre></div>

<p>where <code>token</code> is the path to the Service key file, and <code>calendar_id</code> is the email address of the Google Calendar.   </p>
            <!-- </main> -->
        </div><!-- /.entry-content -->
    </article>
</section>

        <!-- footer -->
        <section id="extras" class="body" data-pagefind-ignore>

        <!-- /.blogroll -->
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://btobsales.eu">Services: BtoBSales.EU</a></li>
                            <li><a href="https://indeXall.io">Side project: indeXall.io</a></li>
                            <li><a href="https://github.com/ndeville">Github: ndeville</a></li>
                        </ul>
                </div>

        <!-- /.social -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://www.linkedin.com/in/ndeville/">Linkedin</a></li>
                            <li><a href="https://www.twitter.com/ndeville">Twitter</a></li>
                        </ul>
                </div>
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body" data-pagefind-ignore>

            <address id="about" class="vcard body">
                <div class="content-row">
                    <img src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/pelican-logo.png" alt="pelican" width="16" height="16"> Powered by <a href="https://getpelican.com" target="_blank"> Pelican</a>
                    <span class="separator">|</span>
                    <img src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/pagefind.png" alt="pagefind" width="16" height="16"> Search by <a href="https://pagefind.app" target="_blank"> Pagefind</a>
                    <span class="separator">|</span>
                    <img src="https://ik.imagekit.io/vhucnsp9j1u/images/logos/clearbit.png" alt="clearbit" width="16" height="16"> Logos by <a href="https://clearbit.com" target="_blank"> Clearbit</a>
                    <span class="separator">|</span>
                    <img src="https://ik.imagekit.io/vhucnsp9j1u/images/python.svg" alt="python_logo" width="16" height="16"> Made with <a href="https://www.python.org/" target="_blank"> Python</a>
                </div>
                <br>
                <div class="content-row">
                    <img src="https://notes.nicolasdeville.com/favicon.svg" alt="nic_logo" width="24"> Nic's notes
                </div>
            </address>

        </footer><!-- /#contentinfo -->


<!-- JS -->

<!-- my JS script (with code block copy) -->
<script src="https://notes.nicolasdeville.com/theme/js/nic.js"></script>

</body>
</html>